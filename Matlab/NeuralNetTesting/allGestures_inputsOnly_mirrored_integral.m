function [Y,Xf,Af] = allGestures_inputsOnly_mirrored_integral(X,Xi,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 09-Sep-2016 12:33:56.
%
% [Y,Xf,Af] = myNeuralNetworkFunction(X,Xi,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
%
%   Xi = 1x2 cell 1, initial 2 input delay states.
%   Each Xi{1,ts} = 8xQ matrix, initial states for input #1.
%
%   Ai = 2x0 cell 2, initial 2 layer delay states.
%   Each Ai{1,ts} = 24xQ matrix, initial states for layer #1.
%   Each Ai{2,ts} = 9xQ matrix, initial states for layer #2.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 9xQ matrix, output #1 at timestep ts.
%
%   Xf = 1x2 cell 1, final 2 input delay states.
%   Each Xf{1,ts} = 8xQ matrix, final states for input #1.
%
%   Af = 2x0 cell 2, final 0 layer delay states.
%   Each Af{1ts} = 24xQ matrix, final states for layer #1.
%   Each Af{2ts} = 9xQ matrix, final states for layer #2.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [-161.0625;-78.9375;-9.63;-6.85;-9.26;-2.390581777;-1.060191572;-1.621675474];
x1_step1_gain = [0.00784506006374111;0.0129136400322841;0.104547830632514;0.12012012012012;0.105097214923805;0.514339046630494;0.953664148818634;0.726738320116895];
x1_step1_ymin = -1;

% Layer 1
b1 = [-11.351727045339942;-1.4616116969570425;-8.4492421070821067;-7.7689453538553126;2.8817369028173401;15.613629443891366;-10.231991820183199;-1.894883292024933;0.83341128674158238;-7.0230459023801863;26.219568455544902;3.6466372727052221;-3.6144154758925975;2.1520094682405739;1.8620390638760964;-2.3549597623997438;-16.875354232978829;-5.0166791517084075;13.32966801548263;-3.2524822759154919;8.375994667844985;9.1810609725576757;3.1148264755586652;-4.5800546096347103];
IW1_1 = [3.0730566413320739 -10.410937145166221 1.3866665034484322 3.7444333199300748 4.4431369357603367 -4.4910254511813861 1.3284168583535181 -1.8369694125096951 -2.9167956669277286 11.125731511404719 -1.2058996963319557 -2.9135241233426035 3.686551038838136 8.5003039269568017 -0.80048881282788786 4.3017946682565809;6.5483817863269032 1.676603720192646 -2.9405227152125901 5.6886883229223493 -4.9332734886739589 25.939969361198393 -1.1089230057010446 4.8557003418892837 -10.644223270262145 3.3759179850531491 -0.43545573117196001 -8.3484197520093559 4.8710886711360111 -24.757629594106596 0.23973451373099908 -4.3932357441612941;5.3181732224384133 4.1370932674386047 -5.2603843279719316 2.1724152524463265 -1.2747334699370199 0.87293099033952604 -4.5791767264076819 -4.2665464378155473 -0.8245443051363115 9.1890999979537344 -1.1935479042849886 0.76876981650213239 5.9132049641764501 -4.0746351749331273 2.9066471242371898 4.6254068903851806;0.51905400624732279 -8.4660566608064887 9.0519955322961607 -20.444893723144858 11.703548716305058 -0.46733808273128985 -4.6209470172655616 0.26152227115688359 -5.3943725635513999 28.360356947234582 -21.936240410521208 19.855976716963259 -8.2086009880780484 3.2358377939574154 2.5829886155528028 -1.3990690299846564;-3.5547799437600265 -7.3850142801159198 3.53307873452157 -1.1450145613134208 0.72865719501814552 -2.5483110237919671 -0.79275091464291503 -0.47353159165082809 -5.2674460382823973 19.815101212107159 -10.921970936041525 -2.1323952825056809 -0.21590805264285165 1.6579310993767284 2.9986154725676819 -0.36741255891504576;2.195398700238183 6.0672970998034907 -3.6102144673689196 1.3059140760420744 -4.4777397972552846 2.0402444240465698 -0.21575957154355493 3.2598366534143484 -5.283300613688751 -17.560434544219316 6.632520073907652 -0.86889102475595736 -9.4975026649658219 -0.024326204604691759 3.8186647700160061 -6.3732918376481553;-5.100480079114134 -4.2425676508389758 8.7665278783448226 -7.3095184899841232 6.7984074509502337 -1.1372595765349591 0.46500111339039218 -5.2757486845288142 3.6268681112075161 23.796275214509606 -21.190476378080497 5.9827610586480207 2.1667762475020833 2.9514112783995552 -1.8255714111877519 6.5267388583480379;5.2671226418393369 -4.9786265019267768 6.0210517320446098 0.16983045961844709 -3.1013117380280253 2.612640215041794 1.4952368196008541 -2.4989168549744831 -4.0984245109968764 -6.0713305741002408 -2.2452086241985594 -0.91626510439892384 1.286288910376294 -2.491628948847973 -1.7577416970086996 2.284970958698457;4.9718818071508153 -4.7032009892962972 2.1785458426292341 6.7060679183417591 -11.126579463490652 1.8569752167430393 -2.2047402713194764 3.5039932847640189 -4.3234651243059856 3.1713246086693205 -2.8066958287942168 -6.9270065028033336 11.646171935172886 2.2195833601440991 -0.94750917209358032 -3.0334115315432073;22.070059935768498 -0.18620270622925639 1.0917592469412698 0.98872145254866983 -6.4856201724627045 -7.1091062979004542 -11.997380403260648 2.2337322500219021 -8.3791991044599712 3.6123118440885071 0.94499011886944617 -1.4514348023890697 10.220792557029739 9.2342412989380076 11.266280141737298 0.44890477526374295;-16.928081556076236 -45.503140489393999 -33.181107768320047 -3.4498983358130291 12.024396799752132 13.396290846660241 2.2452302607296972 -40.244343124952479 -12.12554405870727 26.003699132329608 33.485017836536812 -26.267559649153085 -16.680496105209645 -9.4351153722908414 0.66157684054654742 29.29699960353129;-1.6262001993656667 14.930413699896492 30.582194024313488 -10.653609216762362 -0.75169476605659435 -31.720134398008295 10.894629930218061 2.877882868191211 -9.6355403004803133 -13.717837019861152 -33.488356485654506 3.7731484016207384 -3.1529169765395393 32.620769579535477 -9.5360304756158758 -0.60231760027664594;7.9691682872008611 21.989222147558355 -17.461251887836742 -4.9819573098236152 2.4032193594338676 1.2961993528651863 3.473140888624926 4.2622281298501532 12.447926152989885 19.857250785943783 -13.854506737602698 15.369443248253518 -0.038558379077445151 -1.8851780219001917 -2.8582593026637801 -5.1465154181887227;4.0421152586125606 -6.9057954460625073 14.617962371441783 4.203295256268972 -6.5215009391814522 9.9962475378478537 -2.4118170253491287 -3.8073477256031292 6.2166200135607745 1.6999652711520166 -10.811649626148458 4.8393075504096776 6.9396029417018532 -19.755515617462542 5.0488377319126609 -2.5778380387522652;-5.4046359253332161 -12.605607815507899 5.1077983392639164 2.8359159518492043 -2.8178001971332147 -12.293208764835654 6.1642173682224124 -5.8049473659209418 7.4348492869141172 -7.8915799351890321 8.5622322953234189 -1.1009440295605237 4.1515854365064913 8.9297413520348634 -6.1554487872289307 5.0439776670235741;4.9795940227475359 -4.6914039732784225 4.8682532277198023 -0.52430281480407415 1.5743018317026265 13.528319318341152 -4.995740556042545 6.2896109989194429 -8.1186164882829903 11.500785461796278 -8.8746315688566213 -1.7196523767740315 -2.1038225786914762 -9.5163311221901132 4.7746469233960953 -5.7614433289193228;12.128930882793673 5.6611138267656118 -8.5598517765643169 1.7619780356801606 5.1326992883799099 0.2894909541777177 11.876237770224883 -7.8477099211030819 -23.792903521361108 -4.0332463108735883 8.2747719201504228 -0.30729421561282599 10.828957964558304 3.0972209213115987 -10.250831793094031 8.8366551466552536;-1.1242611536102465 -15.518781332729162 8.3833874217738291 -0.94787091957706604 0.070945380027591709 -4.2541342101318982 -8.2137520718227943 -1.3482864441725948 3.4363965015653504 23.280626951750165 -14.377302144097374 3.7018887979524391 2.911480664852018 3.0160721743789076 7.5621958250305905 -0.52033585594889642;3.5007981539497215 -3.2193437757808354 1.0697924205904061 38.490330980000572 -2.8479133479452861 -50.362365545118152 -3.6867871359124833 3.0373389014558869 -18.695461477238432 -32.045450248355124 30.491671836765185 -35.111223555854011 2.4895739958813339 35.62429027185766 4.5292616526584446 -9.9284175868596058;-4.4246945804072899 -10.288226136024671 -3.0288028963760336 1.831919813765905 3.1983922526801565 1.1659570899414775 -0.59557314259319594 -4.2165231502317679 7.9682589256356344 26.080759678868439 -8.2892446170814811 0.3542848892317928 -2.7236438115772312 -1.8311215596651582 1.0669935809166311 3.8458902182126318;-34.702639721173085 -77.291185404028454 67.881173353522598 -14.78221968384068 15.654531304278123 -25.443935032205587 6.4565015791422748 4.1913961991606756 45.572986559186006 20.968920860981882 -13.690749569234953 22.539486155993508 -10.355504377186854 23.361995267304394 7.0530547892217808 -8.432145094282717;-13.942350558730467 1.5724796786409072 -4.1618193687153315 -2.5070020067037575 -0.21323262468088927 -2.4335668545251137 -1.7697622352539379 2.1610572962767955 1.4188783979618562 -12.777536877854487 18.586771394954738 -0.52214737579418258 -2.2846087187385526 1.98808297034999 1.8024699735775405 -2.0382260005690518;-2.0433054178523271 0.70143603707886193 -8.0154240854425414 -3.0750134884928468 -5.0807462814992128 13.249797577830789 5.740189209543729 3.6412598137302084 2.6273443296977699 -5.0864026909128439 12.303118561986388 2.7011928144689281 2.2045949159589968 -10.083295305209147 -4.7704181586478338 -1.8042398341234054;6.869677423270514 7.4719583447637641 -5.1597087188470523 2.0204076543006004 1.3126384968694813 2.1043710848891997 -0.078998694876714626 1.3615923865926731 4.7711320563920596 -22.695747500571407 14.391738573101113 2.42685391939151 -1.0915435616486515 0.042560149866706087 -2.6208948646569099 0.091601094936216265];

% Layer 2
b2 = [-1.3266002328111204;-0.44212092934806935;-1.9372791182430844;0.37493739589873981;-0.22691906532894557;-0.30859303271846117;-0.1775125737622954;-1.7045909211116266;-1.2513215200422978];
LW2_1 = [0.88728629464952991 -0.90393305433965676 0.92299966292011226 -0.10834528308606559 -2.5515853975261091 0.65938002658343131 0.69254240713652426 -0.69509211328889409 -0.40815007822276217 -0.44335980240428075 0.51055479807397719 -0.56211733800530161 0.36267312434767746 -0.08429077908860988 0.58026759006970852 1.1786351135127076 -0.81714141786619565 0.13244990388411002 0.54538914245845493 -1.1293129219702362 -0.11395042499785737 -0.55911977154737857 0.61807723785410418 -1.8759868269527591;0.85534329435377798 0.13608692261577993 -0.061884627562968759 -0.32703976163498732 0.24662156392460166 -0.04088769564790868 -0.04821752566067105 -0.070339723333216836 0.011709760877130063 -0.032232895627843344 -0.0071049195418499472 0.048815753058070205 0.073887503677934951 0.10111337907143651 -0.084904821142626541 0.1518149785919416 -0.047115380777158662 0.023805222883421542 -0.40484516910819746 -0.0084416202178745556 0.16315270294847567 0.3886189811209072 -0.013031673479838874 0.38115657346004295;-0.29706575615420999 0.69867268508411218 -0.055325677467885526 0.22538625382167468 1.2283349744325265 0.15557057245359177 -0.046938498553544518 0.63088237192112862 0.31497024329773582 -0.042048723681417127 0.2818393073326575 0.32682858351269606 0.41503906260952145 -0.06860246330916886 -0.085946840548439318 -0.6461611352127955 -0.11585731807817458 -0.39675700259440738 -0.028568686061267074 0.28944409573257651 0.11092040202723664 0.38763774918005506 -0.57381254384202451 0.5860839458652618;-0.23452578620942599 0.06532671545145903 0.024817480492983587 0.63625015079787761 0.21448884425959389 0.011667608410010966 -0.056687553732109652 0.056547148074912137 0.043522611273167498 0.045491888540667165 -0.016390254292737126 -0.017751556986749274 -0.073757074132630149 -0.036146052059921843 0.066555763816049732 -0.17142693931337435 0.098012676248778782 -0.11477893302146722 -0.18311085253837955 0.056644377082260583 -1.0294609712370544 0.1835176618017362 -0.044791179532025265 0.10497710943338362;-0.077040405331382289 0.04336401122312851 -0.067911462553761417 0.0060370172639231043 0.27154594800197912 -0.021233438668424882 0.034192141253629099 -0.87914332275959639 0.0011715832202377364 -0.01908359958457977 0.035384161023515034 0.017546885613798472 -0.90053889976505452 -0.019346654549267019 -0.087610679533904695 -0.1724401625182741 -0.014632853075258512 0.038047418197961536 -0.042237885637642414 -0.014015472430635161 0.9066125080802907 -1.8469553521686726 0.024707891835886349 0.1766903345514389;-0.13067125921192177 -0.065459653828396677 -0.02457693654518886 -0.14108552406395997 0.12924230670531106 0.040505777101655774 0.12889018399114385 0.08426966086981405 0.049696552514173438 -0.04050333318670353 0.044096355775452997 0.057718033056310923 0.037107480668686826 -0.0077881614379096131 -0.10580037382146537 -0.075746662012474736 -0.024225067112250344 0.12465352522167683 0.0065926243245271153 0.96176000648661863 -0.017139200999552684 0.031825292556451806 0.020654909894529828 0.078686738236297557;-0.061865127013746676 0.0027479747366186275 0.056704980601313293 0.052773597990270607 0.18947655409057595 0.022311858147512385 -0.041035261531513267 1.0609117680213005 0.018758413100843949 0.047703664107828572 -0.94574874789902308 0.038914438170391676 0.042334433776371895 0.0023559650309383489 0.059101657246951225 0.081410291020588443 -0.018604669087328638 -0.057198055246302865 0.028536247660032994 0.022545375871264119 0.025068280023901095 1.0424545758661898 0.009841597069506736 0.10581047620955381;-0.72957488818450522 -0.00085934627738404757 0.032933452739252023 -0.2432035968200684 -0.093697322922521573 0.1511806641991934 -0.27255578685359649 -0.21361938413599685 -0.11046844661387034 0.25037964730249129 0.14579913917190726 0.14243038646735787 0.064574148124775813 0.077794688838958181 0.26710373610626348 0.28063951854616342 0.76442128438485635 0.21318664053835504 0.076406196574522051 -0.14111374652480196 -0.0049717572223577193 0.14947442369822878 0.089356410639068087 0.058600203494792225;-0.21188636509588024 0.02405374551207979 -0.82775687261469189 -0.10077285238178596 0.36557253365522174 -0.97849537239092099 -0.39019010675720084 0.0255835958325 0.078789361085702503 0.23365315480077337 -0.048429839864442034 -0.052385184722624697 -0.021319779030609318 0.034910077492374833 -0.60876603172441235 -0.6267250027871698 0.17514274542084551 0.036591280152434444 0.0018383829971778919 -0.037510093701353324 -0.040231538891961613 0.22254643966371235 -0.13100265066346828 0.38398144899150649];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = [2;2;2;2;2;2;2;2;2];
y1_step1_xoffset = [0;0;0;0;0;0;0;0;0];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;
if (nargin < 2), error('Initial input states Xi argument needed.'); end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
elseif ~isempty(Xi)
    Q = size(Xi{1},2);
else
    Q = 0;
end

% Input 1 Delay States
Xd1 = cell(1,3);
for ts=1:2
    Xd1{ts} = mapminmax_apply(Xi{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+1,3)+1;
    
    % Input 1
    Xd1{xdts} = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    tapdelay1 = cat(1,Xd1{mod(xdts-[1 2]-1,3)+1});
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
finalxts = TS+(1: 2);
xits = finalxts(finalxts<=2);
xts = finalxts(finalxts>2)-2;
Xf = [Xi(:,xits) X(:,xts)];
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
