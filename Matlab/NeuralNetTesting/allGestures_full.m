function [Y,Xf,Af] = allgesturesfunction(X,Xi,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 06-Sep-2016 08:07:27.
%
% [Y,Xf,Af] = myNeuralNetworkFunction(X,Xi,~) takes these arguments:
%
%   X = 2xTS cell, 2 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
%   Each X{2,ts} = 8xQ matrix, input #2 at timestep ts.
%
%   Xi = 2x2 cell 2, initial 2 input delay states.
%   Each Xi{1,ts} = 5xQ matrix, initial states for input #1.
%   Each Xi{2,ts} = 8xQ matrix, initial states for input #2.
%
%   Ai = 2x0 cell 2, initial 2 layer delay states.
%   Each Ai{1,ts} = 10xQ matrix, initial states for layer #1.
%   Each Ai{2,ts} = 8xQ matrix, initial states for layer #2.
%
% and returns:
%   Y = 1xTS cell of 2 outputs over TS timesteps.
%   Each Y{1,ts} = 8xQ matrix, output #1 at timestep ts.
%
%   Xf = 2x2 cell 2, final 2 input delay states.
%   Each Xf{1,ts} = 5xQ matrix, final states for input #1.
%   Each Xf{2,ts} = 8xQ matrix, final states for input #2.
%
%   Af = 2x0 cell 2, final 0 layer delay states.
%   Each Af{1ts} = 10xQ matrix, final states for layer #1.
%   Each Af{2ts} = 8xQ matrix, final states for layer #2.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-161.0625;-78.9375;-12.59;-12.52;-9.69];
x1_step1.gain = [0.00784506006374111;0.0129136400322841;0.101419878296146;0.091533180778032;0.0611060189428659];
x1_step1.ymin = -1;

% Input 2
x2_step1.xoffset = [0;0;0;0;0;0;0;0];
x2_step1.gain = [2;2;2;2;2;2;2;2];
x2_step1.ymin = -1;

% Layer 1
b1 = [-1.531474758687577209;1.3390885234167146933;-1.0468699373243033346;0.57292601766445938605;0.12778000077966861214;-0.20529920200119425311;-0.58731547175115661474;0.85539094038200924608;-1.1803496805635260714;1.6024093641558703194];
IW1_1 = [-0.028438399295455142612 0.001739892708809851786 -0.097043216227631137749 -0.03387563418660677339 0.047951477013916735115 0.018056018493592475987 0.021244627874497302999 -0.066235616856000892327 -0.0047355293901222969208 0.039491479914826370379;0.023597422355879731776 0.15736156154361202741 0.00078294652923049240512 0.024583383057918222619 0.067660947372908591957 0.014651237620845487114 -0.12224187738697570027 0.2295241921402701446 0.019950873745812357229 0.087313292728966804268;0.49093003373909854803 -0.60027583094730785351 -0.29026399031875327328 0.17035067500708550581 -0.01437151166264009905 0.092254298192371297915 -0.16657398571160073053 -0.11639565581868749344 0.19549211086351675482 -0.12227626993851392623;-0.0018510362811910369488 -0.0043920496504513857616 0.061715476466324636906 0.012205337837865815054 0.034299238088960709581 0.0071302607465469087372 0.034746370897604531014 0.06068680093618410154 0.0052583060152422865172 0.022748986131630552499;-0.056324695399800658868 0.059267360017039652509 -0.10146095661762524753 -0.05740127171589462507 0.16017837021312036905 0.06986296169246898613 0.067459358178706782527 -0.058029605469314071708 0.0093803426692517580254 0.12920103108294445082;-0.039719443803613231625 0.01330956670909359818 -0.021767322551557211768 -0.0041369546681561310958 -0.0113403370267977123 0.0018169609322235260804 -0.037759472738285400351 -0.024028725678309627994 -0.024292969082823516469 -0.023239273340128673018;0.0069373045392565326969 -0.029378147712421351367 0.067000990431256554625 0.0035529258285387447375 -0.054613936204130943131 -0.021233074829347213519 -0.039864993667137992028 0.044814274102578814662 0.0003376496766824533223 -0.072389199071688295484;0.02802431106240526465 -0.097625195614485391071 0.15013231695795367648 -0.035128926262531785796 -0.10569975105013411365 -0.21257912238492929213 0.0044450124090041811392 0.089717299152607024593 -0.0297986818784788908 0.043557910953020681499;-0.21951143695884467455 -0.16455401350686169049 0.10233967717971922951 0.041791823384536207209 -0.084800555279061801128 0.43250865993794268549 -0.16577522446569525894 0.10624998292736667627 -0.09496692946883537878 -0.215258713062478374;0.010197295887716480503 0.10298711898729331904 0.028682640701927338001 0.02283415769902303466 0.063100196597057622849 0.0019908165994057848425 -0.026173973371037436569 0.01154185100388601358 0.025136042613096494514 0.071785497410269474838];
IW1_2 = [0.91139863291292333436 -0.65896839078423719016 -0.30667606741042380269 0.56145796214716814365 -0.11645801894353316475 0.053193377828174223665 -0.72649707929609752544 -0.012782426057086659563 -0.0064258789381117023543 0.0031057235075100191567 0.0049336886673311168908 -0.0044439048394242985571 -0.012887337578710201733 -0.019132902200581558549 -0.013682267955712318006 0.0019820776989211081123;0.15593198396532892414 -0.084748379789643876747 -0.060460730413570147601 0.30129812893359442239 -1.5494600026686311534 -0.268482983024293409 0.21721417159303429978 0.23971793427756793449 0.083609026214938389487 -0.17217859146309319462 -0.18010506487563482381 -0.16979131130219748957 -0.14468841222666339874 0.038731123697930275318 -0.16369601933788929804 -0.1703748229756461563;0.52973043692658017267 0.40544611070938563202 0.39625766480702462324 0.27766306642222082779 0.24015631772746956485 0.48062727474262301186 0.43271977853768295308 0.34826336362354992637 0.53479451625308394025 0.13216121599056884772 -0.23320675530863638203 -0.22243130895074381126 0.70037291840243187657 0.34094298336917794323 -0.25719944295206847995 0.15140816568188394942;0.46835165632468878094 0.39343561904258839146 0.64525949738354804186 -0.33360958807337504073 0.17389727349681935453 -0.81852308492129499662 -0.079445121851173902683 0.053956254356857760723 -0.18695503136663951804 -0.18839324280776351128 -0.18865745144708642722 -0.17524352964868067373 -0.1872804652722296348 -0.16586369307451548361 -0.17428624719804949872 -0.18663187760001700988;1.0876976103472715263 -0.26759187010128765438 -0.37591209081930548885 0.18853613331680699194 -0.37474919922944566197 -0.11942084479485443049 0.66893095869136309783 -0.24347899915413975802 0.046609253178526731387 0.045962647720231758486 0.056657012322214019007 0.056555120578172211887 0.056991048416420185541 0.034342308250251016299 0.01532948028478479767 0.052798085078948252258;0.36115669056120180969 -0.53893026734226123775 0.92147913206771381311 -0.76699773905558277232 -0.37627358806314914474 0.53823207677433260177 -0.032697454096341935226 -0.016177121909225513491 0.10526301391433680321 0.10690460235175641701 0.1030092607381797587 0.11075979077023073716 0.11247495739085873467 0.098488380423206386971 0.10944840103809917731 0.11171689021402254893;-0.089463752493182821524 -0.22648991155959216637 -0.57639499057300580542 0.21934584316318234132 0.40330452695942808905 0.17793787789145376621 0.25382550027839301254 0.29853985867757454331 -0.15419511783538297767 -0.15005604165901081926 -0.14996422565903766433 -0.15187073927792879569 -0.16467676450729459847 -0.12122012344189418698 -0.14889786137470290006 -0.14765655231349081311;-0.25216846132939868541 0.73953752459428145904 0.17931353404688155084 0.33511758566677968263 0.01768637942468772456 0.11934514193816195271 -0.26550316028057913131 -1.1038067332815970634 -0.18030170429425604328 -0.17292858912980793584 -0.17258849436518963749 -0.16741475646776335373 -0.17470601429667473314 -0.16097226530425537416 -0.064331542209584841041 -0.14374572849400180097;0.24186521031560770378 1.0383758884860352367 0.25347179516882856198 -0.27072406418142180851 -0.40299750094909647657 0.2659167865590939539 0.19694164237096928316 -0.34007716534262755204 0.26499693696056969561 0.24458072084845342009 0.21445131164979777671 0.26147759522926594666 0.26314924850980647708 0.42055338314596230065 -0.71444384692669982151 0.28270662774859756095;0.19056255751995726522 0.58515308064260207477 -1.2060746117669476352 -0.48516401300866524027 0.17024219007674890047 0.61826998004921529528 0.52260685661346051312 0.58293613264059573886 -0.14790618058111607014 -0.1486947770323746032 -0.13432399335584846445 -0.12416294837731722822 -0.14534915084156935228 -0.14556159266548326925 -0.15052016177525248675 -0.14316223641761888219];

% Layer 2
b2 = [-1.5757178586014131128;-1.081582915799762068;-0.55334122234553406727;0.11187885139589628936;0.6029965689399944262;0.22392322710949985609;0.19934012686001600922;-1.5980403032420458231];
LW2_1 = [1.0169880354630831398 0.325077841106656662 0.29381256923368870293 1.0501370672338754542 -0.17604613806450519764 0.95740714792319914217 0.27764628390346168807 0.46629010895489542143 -0.118898714108009812 0.92192490945374039324;-0.10709844577635821428 0.34362026691876779161 -0.28891366579096383616 0.21921313173611983727 -0.37490892691039745532 -0.36666911917912664576 -0.74247642653765644205 0.38482904115837651693 1.5753666412268423347 0.55806928954095591511;-0.22399609152772620435 -0.0060480230836404968997 -0.081699794531965186373 0.31412701782509405701 -0.013299769371854397448 0.4462474744219893652 -0.01923788092493680657 0.023283590183254133932 -0.023782057160364352549 -0.68000800593565113861;0.71947392932614129268 0.45395910917893123049 0.43501030505912219315 -0.75695634652807219922 -0.14011960038063336897 -1.3281284579519232469 0.2739095646210590318 0.21022125688268716859 -0.20505027184260402051 -1.2985743326128560415;0.012042624031312452668 -1.616417594732274976 0.55824600079656094831 0.099774772452871432482 -0.088917665756063551941 0.01032073522644931865 -0.020660247650251640367 0.10494325673739021698 -0.35483181372301769718 0.10483014633572029783;-0.037387152973304547954 -0.039325492354148290641 0.41869492497430882416 -1.0005820209088756023 -0.16687962286885271723 0.60900691816671659318 -0.023855117122976055022 0.12510745897024369566 0.13878370490491359623 0.54561147428391032488;-1.451937673237714721 0.08911618607283067206 0.98511908033239847793 -0.30384401040473807409 1.3679548454185339601 -0.42438564153272140267 0.22280475129034946202 -0.0087021799018972677969 0.012789322098087261073 -0.51822770842719956264;0.057301724454612033843 0.38211943419957172807 -0.32531265065769732203 0.30655667559508359421 -0.35503785601470044808 0.064611993254756250327 0.0090122434727620270856 -1.3786415008958057271 -0.88941808595159832507 0.30591574147086780799];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [2;2;2;2;2;2;2;2];
y1_step1.xoffset = [0;0;0;0;0;0;0;0];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;
if (nargin < 2), error('Initial input states Xi argument needed.'); end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
elseif ~isempty(Xi)
    Q = size(Xi{1},2);
else
    Q = 0;
end

% Input 1 Delay States
Xd1 = cell(1,3);
for ts=1:2
    Xd1{ts} = mapminmax_apply(Xi{1,ts},x1_step1);
end

% Input 2 Delay States
Xd2 = cell(1,3);
for ts=1:2
    Xd2{ts} = mapminmax_apply(Xi{2,ts},x2_step1);
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+1,3)+1;
    
    % Input 1
    Xd1{xdts} = mapminmax_apply(X{1,ts},x1_step1);
    
    % Input 2
    Xd2{xdts} = mapminmax_apply(X{2,ts},x2_step1);
    
    % Layer 1
    tapdelay1 = cat(1,Xd1{mod(xdts-[1 2]-1,3)+1});
    tapdelay2 = cat(1,Xd2{mod(xdts-[1 2]-1,3)+1});
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*tapdelay1 + IW1_2*tapdelay2);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
finalxts = TS+(1: 2);
xits = finalxts(finalxts<=2);
xts = finalxts(finalxts>2)-2;
Xf = [Xi(:,xits) X(:,xts)];
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
